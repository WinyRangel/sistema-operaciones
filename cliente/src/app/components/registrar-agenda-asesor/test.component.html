<div class="card shadow-sm bg-body-tertiary rounded w-100 overflow-hidden">
  <div class="card-body p-0">
    <!-- CONTENIDO PRINCIPAL -->
    <div class="container-fluid mt-4 mb-4">
      <div class="row g-4">
        <!-- FORMULARIO -->
        <form class="h-100" [formGroup]="formulario" (ngSubmit)="guardarAgenda()">

          <div class="card shadow-sm h-100">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
              <h4 class="mb-0">
                <i class="bi bi-calendar-plus me-2"></i>Registro de Agenda
              </h4>
            </div>
            <div class="card-body overflow-auto" style="max-height: 80vh;">
              <!-- ================== INFORMACIÓN GENERAL ================== -->
              <div class="card mb-3 shadow-sm">
                <div class="card-header bg-light">
                  <h5 class="mb-0">
                    <i class="bi bi-info-circle me-2"></i>Información General
                  </h5>
                </div>
                <div class="card-body">
                  <div class="row g-3 mb-4">
                    <div class="col-md-12">
                      <div class="form-floating">
                        <input type="text" class="form-control border-2 border-primary rounded-3 shadow-sm"
                          formControlName="asesor" style="height: 60px; font-size: 1.1rem;" readonly />
                        <label class="fw-bold text-primary">
                          <i class="bi bi-person-badge me-2"></i>Asesor
                        </label>
                      </div>
                    </div>
                  </div>
                  <div class="row g-3">
                    <!-- Semana -->
                    <div class="col-md-6">
                      <label class="form-label fw-bold">Semana</label>
                      <select class="form-select" formControlName="semana">
                        <option disabled selected value="">Seleccione semana</option>
                        <option *ngFor="let semana of semanas" [value]="semana">{{ semana }}</option>
                      </select>
                    </div>
                    <!-- Fecha -->
                    <div class="col-md-6">
                      <label class="form-label fw-bold">Fecha</label>
                      <input type="date" class="form-control" formControlName="fecha" id="fecha">
                    </div>
                    <!-- <div class="col-md-6 mb-3">
                      <label class="form-label fw-semibold">Objetivos</label>
                      <div class="card bg-light">
                        <div class="card-body py-2">
                          <div class="row">
                            <div *ngFor="let objetivo of objetivosDisponibles; let i = index" class="col-md-6">
                              <div class="form-check">
                                <input class="form-check-input" type="checkbox" [value]="objetivo"
                                  [checked]="selectedObjetivos.includes(objetivo)" (change)="onObjetivoToggle($event)">
                                <label class="form-check-label">{{ objetivo }}</label>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="card-footer bg-transparent py-1">
                          <small class="text-muted">Selecciona uno o más objetivos</small>
                        </div>
                      </div>
                    </div>
                    <div class="col-6">
                      <label for="meta" class="form-label fw-bold">Meta</label>
                      <textarea class="form-control" id="meta" formControlName="meta" rows="2"
                        placeholder="Escribe tu meta. Ejemplo: Cobranza con las Leles $1000 MXN o Crear 1 grupo nuevo (usa cifras sin comas ni puntos)."></textarea>
                    </div> -->
                  </div>
                </div>
              </div>
              <div class="d-flex justify-content-between align-items-center mb-3">
                <div>
                  <h5 class="fw-semibold mb-0">
                    <i class="bi bi-list-task me-2 text-primary"></i>Actividades
                  </h5>
                  <small class="text-muted">Agregue y complete cada actividad programada</small>
                </div>
              </div>
              <!-- ================== ACTIVIDADES ================== -->
              <div class="mb-3" formArrayName="actividades">
                <h5>
                  <i class="bi bi-list-task me-2"></i>Actividades
                </h5>

                <div *ngFor="let actividad of actividades.controls; let i = index" [formGroupName]="i"
                  class="card mb-3 shadow-sm">
                  <div class="card-header">
                    <span class="badge text-bg-primary">Actividad {{ i + 1 }}</span>
                  </div>

                  <div class="card-body">
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                      <button *ngIf="actividades.length > 1" type="button"
                        class="btn btn-outline-danger btn-sm rounded-circle" (click)="eliminarActividad(i)">
                        <i class="bi bi-x-lg"></i>
                      </button>
                    </div>
                    <div class="row g-3">
                      <!-- Hora -->
                      <div class="col-md-3">
                        <label class="form-label">Hora</label>
                        <input type="time" class="form-control" formControlName="hora" id="hora">
                      </div>
                      <!-- Domicilio -->
                      <div class="col-md-9">
                        <label class="form-label">Domicilio</label>
                        <input type="text" class="form-control" formControlName="domicilio" id="domicilio">
                      </div>
                      <!-- Actividad -->
                      <div class="col-md-6">
                        <label class="form-label">Actividad</label>
                        <textarea class="form-control" formControlName="actividad" id="actividad"></textarea>
                      </div>
                      <!-- Switch -->
                      <!-- <div class="col-md-6">
                        <label class="form-label">Actividad acorde al objetivo</label>
                        <div class="form-check form-switch">
                          <input class="form-check-input" type="checkbox" id="acordeObjetivo{{ i }}"
                            formControlName="acordeObjetivo">
                        </div>
                      </div> -->
                      <!-- CÓDIGO DE ACTIVIDAD (SELECT) -->
                      <div class="col-md-6">
                        <div class="form-floating">
                          <select class="form-select border-2 border-primary rounded-3 shadow-sm"
                            formControlName="codigo" style="height: 60px; font-size: 1.05rem;">
                            <option value="" disabled selected>
                              Seleccione código de actividad
                            </option>
                            <option *ngFor="let opcion of opcionesCodigo" [value]="opcion.value">
                              {{ opcion.texto }}
                            </option>
                          </select>
                          <label class="fw-bold text-primary">
                            <i class="bi bi-tags me-2"></i>Código de actividad
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- ================== BOTONES ================== -->
              <div class="sticky-bottom bg-white pt-4 border-top">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <span class="text-muted small ">
                      <i class="bi bi-info-circle me-1"></i>
                      {{ actividades.length }} actividad{{ actividades.length !== 1 ? 'es' : '' }} registrada{{
                      actividades.length !== 1 ? 's' : '' }}
                    </span>
                  </div>
                  <div class="d-flex gap-3">
                    <button type="button" class="btn btn-primary btn-sm rounded-pill px-4" (click)="agregarActividad()">
                      <i class="bi bi-plus-circle me-1"></i>Agregar Actividad
                    </button>
                    <button type="submit" class="btn btn-success rounded-pill px-4 shadow-sm"
                      [disabled]="formulario.invalid" aria-label="Guardar agenda">
                      <i class="bi bi-save me-1"></i>
                      Guardar Agenda
                      <span *ngIf="actividades.length > 0" class="badge bg-white text-success ms-2">
                        {{ actividades.length }}
                      </span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>